<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>streamsum.caches documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Streamsum 0.1.1-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>streamsum</span></div></div></li><li class="depth-2 branch current"><a href="streamsum.caches.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>caches</span></div></a></li><li class="depth-2 branch"><a href="streamsum.protocols.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocols</span></div></a></li><li class="depth-2 branch"><a href="streamsum.system.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>system</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tuple-counts</span></div></div></li><li class="depth-3 branch"><a href="streamsum.tuple-counts.query-api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query-api</span></div></a></li><li class="depth-3"><a href="streamsum.tuple-counts.update.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>update</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="streamsum.caches.html#var--.3ECaches"><div class="inner"><span>-&gt;Caches</span></div></a></li><li class="depth-1"><a href="streamsum.caches.html#var-assoc-cache.21"><div class="inner"><span>assoc-cache!</span></div></a></li><li class="depth-1"><a href="streamsum.caches.html#var-assoc-last-n.21"><div class="inner"><span>assoc-last-n!</span></div></a></li><li class="depth-1"><a href="streamsum.caches.html#var-dec-count.21"><div class="inner"><span>dec-count!</span></div></a></li><li class="depth-1"><a href="streamsum.caches.html#var-default-cache-server"><div class="inner"><span>default-cache-server</span></div></a></li><li class="depth-1"><a href="streamsum.caches.html#var-get-cache"><div class="inner"><span>get-cache</span></div></a></li><li class="depth-1"><a href="streamsum.caches.html#var-inc-count.21"><div class="inner"><span>inc-count!</span></div></a></li><li class="depth-1"><a href="streamsum.caches.html#var-map-.3ECaches"><div class="inner"><span>map-&gt;Caches</span></div></a></li><li class="depth-1"><a href="streamsum.caches.html#var-new-caches"><div class="inner"><span>new-caches</span></div></a></li><li class="depth-1"><a href="streamsum.caches.html#var-record.21"><div class="inner"><span>record!</span></div></a></li><li class="depth-1"><a href="streamsum.caches.html#var-reset-caches.21"><div class="inner"><span>reset-caches!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">streamsum.caches</h2><div class="doc"><pre class="plaintext">
cache-config is a mapping from cache name (as keyword) to cache type.

There are currently three types of caches:
* associative -- simple kv mapping
* lastn -- last N  values are retained per key
* lastn-distinct -- last N distinct values are retained per key
* count -- each occurrence of a [pred subj obj] is counted, and the associated times may be retained as a sequence.

caches is a table of all the available caches.  Keys match pred field in incoming tuples.  Values are java.util.Map instances.

cache-update-fns is a mapping from cache key (keyword) to an update function (used by the record module).

The CacheServer protocol provides a (mutable) cache backing store

TODO: 
* Use RRB tree to implement proper distinct last-n
* Extensibility of assoc functions
* convention for mapping tuples to &apos;undo&apos; operations (dec-count! dissoc!, etc)</pre></div><div class="public anchor" id="var--.3ECaches"><h3>-&gt;Caches</h3><div class="usage"><code>(-&gt;Caches cache-config cache-server caches cache-update-fns)</code></div><div class="doc"><pre class="plaintext">Positional factory function for class streamsum.caches.Caches.
</pre></div></div><div class="public anchor" id="var-assoc-cache.21"><h3>assoc-cache!</h3><div class="usage"><code>(assoc-cache! cache [_ s o _ :as tuple])</code></div><div class="doc"><pre class="plaintext">Accepts tuples of the form [cache-key s o time]
Mutate the cache, associating key s with value o, replacing any previous value.
Ignores any other elements in the tuple.
Returns [cache-key s o time].</pre></div></div><div class="public anchor" id="var-assoc-last-n.21"><h3>assoc-last-n!</h3><div class="usage"><code>(assoc-last-n! cache [cache-key key obj t] buf-size)</code></div><div class="doc"><pre class="plaintext">Mutate the last-n cache, adding an association from key to obj, evicting the oldest association if necessary.
Returns a tuple [cache key lastn t] where lastn is the last-n value stored in the cache.</pre></div></div><div class="public anchor" id="var-dec-count.21"><h3>dec-count!</h3><div class="usage"><code>(dec-count! cache [cache-key s [a o] time :as tuple])</code></div><div class="doc"><pre class="plaintext">Accepts tuples of the form [cache-key s [a o] time].  
Calls (tuple-counts.update.dec-count! [s a o time]) to update the count cache.</pre></div></div><div class="public anchor" id="var-default-cache-server"><h3>default-cache-server</h3><div class="usage"><code>(default-cache-server)</code></div><div class="doc"><pre class="plaintext">An in-proces CacheServer implemented using Java HashMaps
</pre></div></div><div class="public anchor" id="var-get-cache"><h3>get-cache</h3><div class="usage"><code>(get-cache cache-info cache-key)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-inc-count.21"><h3>inc-count!</h3><div class="usage"><code>(inc-count! cache [cache-key s [a o] time :as tuple])</code></div><div class="doc"><pre class="plaintext">Accepts tuples of the form [cache-key s [a o] time].  
Calls (tuple-counts.update.inc-count! [s a o time]) to update the count cache.</pre></div></div><div class="public anchor" id="var-map-.3ECaches"><h3>map-&gt;Caches</h3><div class="usage"><code>(map-&gt;Caches m__6289__auto__)</code></div><div class="doc"><pre class="plaintext">Factory function for class streamsum.caches.Caches, taking a map of keywords to field values.
</pre></div></div><div class="public anchor" id="var-new-caches"><h3>new-caches</h3><div class="usage"><code>(new-caches cache-config cache-server)</code></div><div class="doc"><pre class="plaintext">Factory function for Caches component
</pre></div></div><div class="public anchor" id="var-record.21"><h3>record!</h3><div class="usage"><code>(record! cache-info metrics-component [cache-key _ _ _ :as tuple])</code></div><div class="doc"><pre class="plaintext">The record function takes a 4-tuple of the form [cache-key key val time] and updates the appropriate cache based on the value of cache-key.
Returns a tuple to be placed on the cache persistence queue of the form [cache-key key val&apos; time], where val&apos; is the
value associated with key in the cache.  For some cache update functions val&apos; may be different than the original tuple val.</pre></div></div><div class="public anchor" id="var-reset-caches.21"><h3>reset-caches!</h3><div class="usage"><code>(reset-caches! cache-info)</code></div><div class="doc"><pre class="plaintext"></pre></div></div></div></body></html>